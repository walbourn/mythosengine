;
;
;                                /\    /\
;                               /  \  /  \
;                              /    \/    \
;                             /  /\    /\  \
;                            /  /  \  /  Y T H O S
;                           /  /    \/    \  \
;                          /  /            \  \
;                         /__/              \__\
;
;                    Microsoft Windows 95/NT Version
;
;            Copyright (c) 1994-1998 by Charybdis Enterprises, Inc.
;                           All Rights Reserved.
;
;
;
;           *** Charybdis Enterprises, Inc. Company Confidential ***
;
;  This file and all associated files are the company proprietary property
;        of Charybdis Enterprises, Inc.  Unauthorized use prohibited.
;
; CHARYBDIS ENTERPRISES, INC. MAKES NO WARRANTIES, EXPRESS OR IMPLIED, AS
; TO THE CORRECTNESS OF THIS CODE OR ANY DERIVATIVE WORKS WHICH INCORPORATE
; IT.  CHARYBDIS ENTERPRISES, INC. PROVIDES THE CODE ON AN "AS-IS" BASIS
; AND EXPLICITLY DISCLAIMS ANY LIABILITY, INCLUDING CONSEQUENTIAL AND
; INCIDENTAL DAMAGES FOR ERRORS, OMISSIONS, AND OTHER PROBLEMS IN THE CODE.
;
;
;
; mytmmx.asm
;
; Contains the mythos_detect_mmx routine.
;
;

.586p

        OPTION SCOPED                   ; Enable local labels.

;
;
;                                Includes
;                                
;

include macros.inc

;
;
;                                 Data
;
;

       ASSUME  ds:_DATA
_DATA  SEGMENT PARA PUBLIC USE32 'DATA'
_DATA  ENDS

;
;
;                                 Code
;
;

_TEXT  SEGMENT PARA PUBLIC USE32 'CODE'

;Ŀ
; int mythos_detect_mmx();                                                 
;                                                                          
; Returns 1 if MMX instructions are supported, 0 otherwise.                
;

START_PROC     mythos_detect_mmx,  C
        push    ebx

; See if CPU ID will be supported by checking if bit 21 is writable
        pushfd
        pop     eax
        mov     edx, eax
        xor     eax, 00200000h
        push    eax
        popfd
        pushfd
        pop     eax
        cmp     eax, edx
        jz      no_mmx
        cmp     eax, 1
        jl      no_mmx

; Execute CPUID and check feature bit for MMX (bit 23)
        mov     eax,1
        cpuid
        and     edx, 00800000h
        jz      no_mmx

; MMX Found!
        mov     eax,1
        jmp     exit

no_mmx:
        xor     eax,eax

exit:
        pop     ebx
        ret
END_PROC       mythos_detect_mmx

_TEXT   ends
        end

; End of module - mytmmx.asm 
